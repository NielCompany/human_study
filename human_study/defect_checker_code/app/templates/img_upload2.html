{% extends "layout/layout.html" %}

{% block title_block %}
  <title>AI 하자 점검 - 이미지 업로드</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/upload2.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
{% endblock %}

{% block content %}
<main class="upload-wrapper">
  <div class="upload-card">
    <h2>하자 이미지를 업로드 해주세요</h2>
    <p>AI가 자동으로 분석하고 결과를 생성해드립니다.</p>

    <form method="POST" enctype="multipart/form-data" class="upload-form" id="upload-form">
      <div class="upload-dropzone" id="dropzone">
        <i class="fas fa-image fa-3x drop-icon" id="drop-icon"></i>
        <p class="drop-text" id="drop-text">Upload File</p>
        <input type="file" id="image" name="image" accept="image/*" onchange="previewImage(event)" required hidden>
        <img id="preview" src="#" alt="미리보기" style="display: none;" />
      </div>

      <button type="submit"><i class="fas fa-robot"></i> 예측 시작</button>
    </form>
  </div>
</main>

<script>
  const dropzone = document.getElementById('dropzone');
  const fileInput = document.getElementById('image');
  const preview = document.getElementById('preview');
  const icon = document.getElementById('drop-icon');
  const text = document.getElementById('drop-text');

  dropzone.addEventListener('click', () => fileInput.click());

  dropzone.addEventListener('dragover', (e) => {
    e.preventDefault();
    dropzone.classList.add('dragging');
  });

  dropzone.addEventListener('dragleave', () => {
    dropzone.classList.remove('dragging');
  });

  dropzone.addEventListener('drop', (e) => {
    e.preventDefault();
    dropzone.classList.remove('dragging');
    fileInput.files = e.dataTransfer.files;
    previewImage({ target: fileInput });
  });

  function previewImage(event) {
    const input = event.target;

    if (input.files && input.files[0]) {
      const reader = new FileReader();
      reader.onload = function (e) {
        preview.src = e.target.result;
        preview.style.display = "block";
        icon.style.display = "none";
        text.style.display = "none";
      };
      reader.readAsDataURL(input.files[0]);
    }
  }
</script>
{% endblock %}